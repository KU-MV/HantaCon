<html>
  <head>
    <title>Hantacon</title>
  </head>  
  <body>

    <div style="text-align: center; margin-top: 20; margin-bottom: 20;">
      <img src="./img/top.png">
    </div>
    <div class="refs" style="display: none">
    </div>

    <div class="config" style="display: none">
        <input id="basePath", type="text", value="">
        <input id="dataPath", type="text", value="">
    </div>


    <div class="listview" style="width : 100%; height: 400px; border: none 10px; overflow-y: scroll;">
    </div>
    
    <div>
      <progress value="0" max="100" style="height: 25px; width : 100%;"></progress>
    </div>
    
    <div style="width: 100%; height: 50; margin-top: 10; margin-bottom: 10;">
      <button class="allSelect disabled-event" onclick="allSelect()" style="width: 150; height: 45; display: flex; align-items: center; float:left; margin-left: 15;">
        <img src="./img/selection.jpg" style="width: 30; height: 30; float:left;">
        <label style="font-size: 18; margin-left: 5;">All select</label>
      </button>

      <button class="delete disabled-event" onclick="deleteItems()" style="width: 150; height: 45; display: flex; align-items: center; float:left; margin-left: 15;">
        <img src="./img/delete.png" style="width: 30; height: 30; float:left;">
        <label style="font-size: 18; margin-left: 5;">Items delete</label>
      </button>

      <button class="file disabled-event" style="width: 150; height: 45; display: flex; align-items: center; float:left; margin-left: 15;">
        <img src="./img/Search.png" style="width: 30; height: 30; float:left;">
        <label style="font-size: 18; margin-left: 5;">File find</label>
      </button>

      <button class="folder" style="width: 150; height: 45; display: flex; align-items: center; float:left; margin-left: 15;">
        <img src="./img/folder.png" style="width: 30; height: 30; float:left;">
        <label style="font-size: 18; margin-left: 5;">folder</label>
      </button>
      
      <button class="run disabled-event" style="width: 150; height: 45; display: flex; align-items: center; float:left; margin-left: 15;">
        <img src="./img/Run.png" style="width: 30; height: 30; float:left;">
        <label style="font-size: 18; margin-left: 5;">Run</label>
      </button>

      <label style="margin-left: 15; font-size:18px;"> Threshold
        <input type="number" class="spinner" id="threshold" min="0" max="9999" step="1" value="10" style="width: 60; height: 25; font-size:18px;">
      </label>
    </div>
    <div style="margin-top: 20;">
    
    </div>
    <div style="margin-top: 20;">
      <div style="float:left; margin-left: 25;">
        <img src="./img/KU.png" >
      </div>
      <div  style="float:left; margin-left: 25;">
        <img src="./img/NRF.png" >
    </div>
      <div  style="width:50%; float:left; margin-left: 25;">
        <p>
          This work is made possible by the open sharing of genetic data by various research groups. These results were generated by the Korea university (Project Instructor: Name) in Republic of Korea. This project was supported by the Research Program To Solve Social Issues of the National Research Foundation of Korea (NRF) funded by the Ministry of Science and ICT (NRF-2023000000).
          Built with KU-HantaCon. Maintained by Jin-Won Song (Korea University).
        </p>
      </div>
    </div>




  </body>
  <script src="./jquery-3.7.0.min.js"></script>
  <script>
    
    itme_index = 0;
    
    document.querySelector('button.file').addEventListener('click', () => {
      file_find.openDialog();
    });

    //document.querySelector('button.run').addEventListener('click', () => {
    //  file_find.runShell(chkItems());
    //});
    
    document.querySelector('button.run').addEventListener('click', () => {
      file_find.runShell(chkItems());
    });

    document.querySelector('button.folder').addEventListener('click', () => {
      file_find.openBase();
    });
    
    function progress_add(){
      document.querySelector('progress').value += 1
    }

    function progress_result(value){
      document.querySelector('progress').value = 0
      document.querySelector('progress').max = value
    }

    function additems(itme_name) {
      /**
      <div>
        <input type="checkbox" id="item">
        <label for="item">[대기중]</label>
        <label for="item">파일</label>
      </div>
      <input class="file" style="width:600px;"></input>
      <button class="run2" onclick="additems()">추가</button>
          <button class="run2" onclick="additems('test')">추가</button>
      <button class="run3" onclick="chkItems()">체크아이템</button>
      <button class="run4" onclick="setStatus('item2','완료')">상태변경</button>
      <link rel="stylesheet" type="text/css" href="loding.css" />
        <div class="loading-container" style="display:none;">
        <div class="loading"></div>
        <div id="loading-text">loading</div>
      </div> style="display: none"

            <button class="run2" onclick="additems('test')">추가</button>
      <button class="run2" onclick="refAdd('test',['L.fasta','S.fasta','M.fasta'])">추가</button>
      <button class="run3" onclick="chkItems()">체크아이템</button>
      **/

      itme_index += 1
      let itme_id = 'item' + itme_index
      let root = document.querySelector("div.listview");
      let newDiv = document.createElement("div");
      newDiv.id = itme_id
      root.appendChild(newDiv);
      let newInput = document.createElement("input");
      newInput.className = "disabled-event"
      newInput.type = 'checkbox'
      newInput.id = itme_id
      newInput.value = itme_name
      newInput.checked = true
      newDiv.appendChild(newInput);
      let newlabel = document.createElement("label");
      let newContent = document.createTextNode('[ 대기 중 ] ');
      newlabel.appendChild(newContent);

      newDiv.appendChild(newlabel);

      let newlabel2 = document.createElement("label");
      let newContent2 = document.createTextNode(itme_name);
      newlabel2.appendChild(newContent2);

      newDiv.appendChild(newlabel2);

      let newSelect = document.createElement("select");
      newSelect.className = "disabled-event"
      let ref_divs = document.querySelectorAll("div.refs > div").forEach((ref) => {
        ref_id = ref.id
        newOption = document.createElement("option");
        optionContent = document.createTextNode(ref_id)
        newOption.value = ref_id
        newOption.appendChild(optionContent)
        newSelect.appendChild(newOption)
        newDiv.appendChild(newSelect)
      })
      newSelect.style = 'margin: 5px;'
      
      for ( let ref in ref_divs ) {
        //console.log(ref)
        //newOption = document.createElement("option");
        //optionContent = document.createTextNode(test1234[test123])
        //newOption.value = test1234[test123]
        //newOption.appendChild(optionContent)
        //newSelect.appendChild(newOption)
        //newDiv.appendChild(newSelect)
      }


    }

    function refAdd(ref_name, ref_files) {
      
      let root = document.querySelector("div.refs");

      let newDiv = document.createElement("div");
      newDiv.id = ref_name
      root.appendChild(newDiv);
      for ( ref_file in ref_files ) {

        newlabel = document.createElement("label");
        if ( ref_files[ref_file].includes('_L.fasta') == true || ref_files[ref_file].includes('_L_') == true ) {
          newlabel.id = 'L'
        } else if ( ref_files[ref_file].includes('M.fasta') == true || ref_files[ref_file].includes('_M_') == true) {
          newlabel.id = 'M'
        } else if ( ref_files[ref_file].includes('S.fasta') == true || ref_files[ref_file].includes('_S_') == true) {
          newlabel.id = 'S'
        } else {
          break
        }
        newContent = document.createTextNode(ref_files[ref_file]);
        newlabel.appendChild(newContent);
        newDiv.appendChild(newlabel);
      }


    }

    function chkItems() {
      let checkbox_list = $('div.listview input')
      let basePath = document.querySelector('div.config input#basePath').value
      let dataPath = document.querySelector('div.config input#dataPath').value
      let threshold = document.querySelector('input#threshold').value
      result = []
      for (let item of checkbox_list) {
        if (item.checked == true) {
          let value = getValue(item.id)
          
          option = document.querySelector('div#'+item.id+' select').value
          console.log('div.refs div#'+ option +' label#L')
          option_L = document.querySelector('div.refs div#'+ option +' label#L').textContent
          option_M = document.querySelector('div.refs div#'+ option +' label#M').textContent
          option_S = document.querySelector('div.refs div#'+ option +' label#S').textContent
          obj = {
            "itemId": item.id,
            "value": value,
            "threshold": threshold,
            "option": {
              'name': option,
              'L': option_L,
              'M': option_M,
              'S': option_S
            },
            "basePath": basePath,
            "dataPath": dataPath
          }

          result.push(obj)
        }
      }
      console.log(result)
      return result
    }

    function getValue(itemId) {
      let text = document.querySelector('input#'+itemId).getAttribute('value')
      return text
    }

    function setStatus(itemId, status) {
      document.querySelector('div.listview div#'+itemId+' label').textContent = status
    }

    function elementDisabled(value) {
      console.log(value)
      let button_list = $('.disabled-event')
      for (let item of button_list) {
        console.log(item)
        item.disabled = value
      }
    }


    function allSelect() {
      let checkbox_list = $('div.listview input')
      check_true = false
      for (let item of checkbox_list) {
        if (item.checked == false) {
          check_true = true
        }
      }
      for (let item of checkbox_list) {
        item.checked = check_true
      }
    }

    function deleteItems() {
      let checkbox_list = $('div.listview input')
      for (let item of checkbox_list) {
        if (item.checked == true) {
          let itemId = item.id
          document.querySelector('div.listview div#'+itemId).remove()
        }
      }
    }

  </script>
</html>